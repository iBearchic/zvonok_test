# Условие

1 - Задача на подумать:
Есть веб-сервис А, принимающий запросы от пользователей, запросов может приходить в час 200 000. В день приходит до 2 000 000 запросов
Сервис А должен отправить эти данные в сервис Б, чтоб обработать данные. 
Сервис Б может обработать 100 000 запросов в час. 
Запросы от пользователей поступающий в сервис А нельзя потерять.
Как бы вы организовали межсервисное взаимодействие, хранение данных, результатов, какие инструменты  использовали бы для этого?

# Решение

## Архитектура взаимодействия сервисов:

а) Сервис А получает запросы и помещает их в очередь (Kafka)
а*) Запросы могут помимо прочег сохраняться в БД (PostgreSQL) для долгосрочного хранения (в качестве бэкап версии на случай отказа броккеров), а также для мониторинга 
б) Сервис Б подписывается на очередь и обрабатывает запросы в рамках своих лимитов
в) После обработки результат сохраняется в БД или возращается Сервису А (при необходимости)

## Важно отметить:
1. Преимущество использования броккера сообщений - очевидно: во-первых, это гарантия, что запросы не будут потеряны, даже если Б перегружен или временно недоступен. Во-вторых, это возможность контроля и распределения нагрузки исходя из пропускных способностей Сервисов. Контроль нагрузки (ее равномерности) можно осуществить, например, подключив Celery-воркеров  
2. Почему стоит (при возможности ресурсной) сохранять поступающие запросы в БД? Во-первых6 резервная копия. Во-вторых, хранения статусов запросов и их обработки
3. Мониторинг (Grafana + Prometheus core) необходимы, чтобы выявить узкие места в состояниях очередей, скорости обработки запросов. Тогда мы становимся более гибки для написания стратегий ретраев в Celery для неудачных запросов
4. Если peak-load будет происходить все чаще и чаще, то стоит задуматься в пользу создания большего числа инстансов Сервиса Б для того, чтобы параллелльно обрабатывать данные из очереди, в которой в свою очередь также можно и нужно будет внедрить партишн чтобы равномерно нагружать инстансы Сервиса Б

## Используемые для реализации инструменты:
1. Взаимодействие между сервисами, а именно передача запросов - брокер сообщений (Kafka или например RabbitMQ)
2. Долгосрочное хранение запросов, статусов для безопасности и мониторинга - PostgreSQL
3. Контроль нагрузки и участие в фоновых задачах - Celery
4. Мониторинг состояния системы, нагрузки очередей для возможности оптимизации процессов - Grafana + Prometheus

## Дополнительные соображения:
1. Если запросы со стороны сервиса А предполагаются долгие запросы - стоит рассмотреть модель "Long polling"
